schema: '2.0'
stages:
  pull_data:
    cmd: mkdir -p data/raw && poetry run kaggle competitions download -c playground-series-s4e12
      && mv playground-series-s4e12.zip data/raw/ && cd data/raw/ && unzip playground-series-s4e12.zip
      && rm playground-series-s4e12.zip
    outs:
    - path: data/raw
      hash: md5
      md5: 81fcdcb7e37e0ac83770494236eb8c60.dir
      size: 332735146
      nfiles: 3
  prepare_basic:
    cmd: poetry run python insurance/prepare_basic.py
    deps:
    - path: insurance/prepare_basic.py
      hash: md5
      md5: 9e108eb9a1de356116285e1eada7ac45
      size: 942
    params:
      params.yaml:
        data.random_state: 42
    outs:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: 6f2ff9d50624a8441f17f3daf678d382
      size: 51335522
  train_basic:
    cmd: poetry run python insurance/train_basic.py
    deps:
    - path: data/prepared/prepared_data.csv
      hash: md5
      md5: be6d2a66bbfc1ca11856fe43b15f938d
      size: 164008012
    - path: insurance/train_basic.py
      hash: md5
      md5: 1087798e3a88729a780248839e5d4271
      size: 4474
    outs:
    - path: out/models/model_basic.pkl
      hash: md5
      md5: 4b8a371d04e5278a135523ea5aa7dc66
      size: 145233
  train@basic:
    cmd: poetry run python insurance/train_basic.py
    deps:
    - path: data/prepared/prepared_imputed_data.feather
      hash: md5
      md5: 540c4b236beb05faeda036c5adbd7429
      size: 58049042
    - path: insurance/data_pipeline.py
      hash: md5
      md5: 3eec6e7d1c5eea1daccba3532417f362
      size: 3245
    - path: insurance/train_basic.py
      hash: md5
      md5: 5c9c38071cc78463eb8fc2abba4f039d
      size: 4636
    params:
      params.yaml:
        train.basic:
        train.n_splits: 5
        train.random_state: 42
    outs:
    - path: out/models/data_pipeline_basic.pkl
      hash: md5
      md5: b96209877d55303005fe34d2e0e03e1e
      size: 33615
    - path: out/models/model_basic.pkl
      hash: md5
      md5: b96209877d55303005fe34d2e0e03e1e
      size: 33615
  train@xgboost:
    cmd: poetry run python insurance/train_xgboost.py
    deps:
    - path: data/prepared/prepared_imputed_data.feather
      hash: md5
      md5: 540c4b236beb05faeda036c5adbd7429
      size: 58049042
    - path: insurance/data_pipeline.py
      hash: md5
      md5: 3eec6e7d1c5eea1daccba3532417f362
      size: 3245
    - path: insurance/train_xgboost.py
      hash: md5
      md5: ceabdaa0b46f136e34303f08a369764a
      size: 3203
    params:
      params.yaml:
        train.n_splits: 5
        train.random_state: 42
        train.xgboost:
          random_state: 42
          device: cuda
          objective: reg:squarederror
          eval_metric: rmse
          booster: gbtree
          lambda: 0.4104749889610154
          alpha: 5.561529990659432e-07
          subsample: 0.9814736188143719
          colsample_bytree: 0.7240915982708991
          max_depth: 7
          min_child_weight: 9
          eta: 0.4324358241129275
          gamma: 2.865477838059048e-06
          grow_policy: depthwise
    outs:
    - path: out/models/data_pipeline_xgboost.pkl
      hash: md5
      md5: fd9986981188f504b8a7d9f9dc67e68c
      size: 1204
    - path: out/models/model_xgboost.pkl
      hash: md5
      md5: f5ed57c419ce8b7331f89ce3f08d82a2
      size: 33002
  train_imputer:
    cmd: poetry run python insurance/train_imputer.py
    deps:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: be9be223edd7835c118acb707733196d
      size: 57045410
    - path: insurance/data_pipeline.py
      hash: md5
      md5: 5b3ebe7bd623c9cb606fc8f0e2735e76
      size: 3308
    - path: insurance/train_imputer.py
      hash: md5
      md5: 392f99313c616f6202db27b2ced378f6
      size: 7028
    params:
      params.yaml:
        torch_imputer:
          epochs: 50
          lr: 0.001
          batch_size: 2048
    outs:
    - path: out/models/torch_imputer.pt
      hash: md5
      md5: 7537c1a3a36c27d5b0852c44e8090698
      size: 6340
    - path: out/models/torch_imputer_data_pipeline.pkl
      hash: md5
      md5: 366088dae5e98c16271032306fbaf220
      size: 3037
  impute:
    cmd: poetry run python insurance/run_imputer.py
    deps:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: be9be223edd7835c118acb707733196d
      size: 57045410
    - path: insurance/data_pipeline.py
      hash: md5
      md5: 5b3ebe7bd623c9cb606fc8f0e2735e76
      size: 3308
    - path: insurance/run_imputer.py
      hash: md5
      md5: 0ea052fdd86050efeb668dcd5d59a08f
      size: 2531
    - path: out/models/torch_imputer.pt
      hash: md5
      md5: 7537c1a3a36c27d5b0852c44e8090698
      size: 6340
    - path: out/models/torch_imputer_data_pipeline.pkl
      hash: md5
      md5: 366088dae5e98c16271032306fbaf220
      size: 3037
    outs:
    - path: data/prepared/prepared_imputed_data.feather
      hash: md5
      md5: c34e946b732269f7b58cb0542bd73620
      size: 56337066
  tune_xboost:
    cmd: poetry run python insurance/tune_xgboost.py data/prepared/prepared_data.feather
    deps:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: be9be223edd7835c118acb707733196d
      size: 57045410
    - path: insurance/data_pipeline.py
      hash: md5
      md5: 62daeae84ed48ce63fd650e97c9736be
      size: 5106
    - path: insurance/tune_xgboost.py
      hash: md5
      md5: 7ba6c082008e87c59d02b391dfd02ec4
      size: 5804
    outs:
    - path: out/xgboost_model_params.yaml
      hash: md5
      md5: 11bca7628477bb73deaa189557db0d33
      size: 250
  train_xgboost:
    cmd: poetry run python insurance/train_xgboost.py data/prepared/prepared_data.feather
    deps:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: 6f2ff9d50624a8441f17f3daf678d382
      size: 51335522
    - path: insurance/data_pipeline.py
      hash: md5
      md5: a1056f8641075af2816bbc8e98130017
      size: 7656
    - path: insurance/train_xgboost.py
      hash: md5
      md5: 2df9ae4f05142d5d7bf92582f14ca4a5
      size: 6044
    outs:
    - path: out/data_pipeline_train_xgboost.pkl
      hash: md5
      md5: 8d8abc8de6a7ac207aa23190152cf086
      size: 10108
    - path: out/models/xgboost_model.pkl
      hash: md5
      md5: 4901e94cdd53eeb851c5bff8507dfa36
      size: 111527608
  train_catboost:
    cmd: poetry run python insurance/train_catboost.py data/prepared/prepared_data.feather
    deps:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: 6f2ff9d50624a8441f17f3daf678d382
      size: 51335522
    - path: insurance/data_pipeline.py
      hash: md5
      md5: a1056f8641075af2816bbc8e98130017
      size: 7656
    - path: insurance/train_catboost.py
      hash: md5
      md5: 025b0be06a3b33085c1b8da722067ae9
      size: 3765
    outs:
    - path: out/data_pipeline_train_catboost.pkl
      hash: md5
      md5: 8d8abc8de6a7ac207aa23190152cf086
      size: 10108
    - path: out/models/catboost_model.pkl
      hash: md5
      md5: 721cf334cfa1951a5769f1010b4ce574
      size: 17133865
  train_ensemble:
    cmd: poetry run python insurance/train_ensemble.py data/prepared/prepared_data.feather
    deps:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: 6f2ff9d50624a8441f17f3daf678d382
      size: 51335522
    - path: insurance/data_pipeline.py
      hash: md5
      md5: a1056f8641075af2816bbc8e98130017
      size: 7656
    - path: insurance/train_ensemble.py
      hash: md5
      md5: 5936f10a47757f64b4d5b7c0bc0de580
      size: 8642
    - path: out/models/catboost_model.pkl
      hash: md5
      md5: 721cf334cfa1951a5769f1010b4ce574
      size: 17133865
    - path: out/models/xgboost_model.pkl
      hash: md5
      md5: 4901e94cdd53eeb851c5bff8507dfa36
      size: 111527608
    outs:
    - path: out/data_pipeline_train_ensemble.pkl
      hash: md5
      md5: 1ff50e7253727b02bc42823b2b6060e2
      size: 10407
    - path: out/models/ensemble_model.pkl
      hash: md5
      md5: 8f175b050c8a2760eb21b1172d537185
      size: 9686309
