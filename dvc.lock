schema: '2.0'
stages:
  pull_data:
    cmd: mkdir -p data/raw && poetry run kaggle competitions download -c playground-series-s4e12
      && mv playground-series-s4e12.zip data/raw/ && cd data/raw/ && unzip playground-series-s4e12.zip
      && rm playground-series-s4e12.zip
    outs:
    - path: data/raw
      hash: md5
      md5: 81fcdcb7e37e0ac83770494236eb8c60.dir
      size: 332735146
      nfiles: 3
  prepare_basic:
    cmd: poetry run python insurance/prepare_basic.py
    deps:
    - path: insurance/prepare_basic.py
      hash: md5
      md5: cd00a7ca3b9157c32997b98c147e36f3
      size: 940
    params:
      params.yaml:
        data.random_state: 42
    outs:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: be9be223edd7835c118acb707733196d
      size: 57045410
  train_basic:
    cmd: poetry run python insurance/train_basic.py
    deps:
    - path: data/prepared/prepared_data.csv
      hash: md5
      md5: be6d2a66bbfc1ca11856fe43b15f938d
      size: 164008012
    - path: insurance/train_basic.py
      hash: md5
      md5: 1087798e3a88729a780248839e5d4271
      size: 4474
    outs:
    - path: out/models/model_basic.pkl
      hash: md5
      md5: 4b8a371d04e5278a135523ea5aa7dc66
      size: 145233
  train@basic:
    cmd: poetry run python insurance/train_basic.py
    deps:
    - path: data/prepared/prepared_imputed_data.feather
      hash: md5
      md5: 540c4b236beb05faeda036c5adbd7429
      size: 58049042
    - path: insurance/data_pipeline.py
      hash: md5
      md5: 5dadb2e52bc9356783bace5094a047f6
      size: 3222
    - path: insurance/train_basic.py
      hash: md5
      md5: 5c9c38071cc78463eb8fc2abba4f039d
      size: 4636
    params:
      params.yaml:
        train.basic:
        train.n_splits: 5
        train.random_state: 42
    outs:
    - path: out/models/data_pipeline_basic.pkl
      hash: md5
      md5: b96209877d55303005fe34d2e0e03e1e
      size: 33615
    - path: out/models/model_basic.pkl
      hash: md5
      md5: b96209877d55303005fe34d2e0e03e1e
      size: 33615
  train@xgboost:
    cmd: poetry run python insurance/train_xgboost.py
    deps:
    - path: data/prepared/prepared_imputed_data.feather
      hash: md5
      md5: 540c4b236beb05faeda036c5adbd7429
      size: 58049042
    - path: insurance/data_pipeline.py
      hash: md5
      md5: 5dadb2e52bc9356783bace5094a047f6
      size: 3222
    - path: insurance/train_xgboost.py
      hash: md5
      md5: 12b82287a2894cda952a1eac0e9202dc
      size: 3245
    params:
      params.yaml:
        train.n_splits: 5
        train.random_state: 42
        train.xgboost:
          random_state: 42
          device: cuda
          objective: reg:squarederror
          eval_metric: rmse
          booster: gbtree
          lambda: 6.843302774035178e-05
          alpha: 0.006258449730947676
          subsample: 0.901647304077349
          colsample_bytree: 0.922549532305334
          max_depth: 5
          min_child_weight: 9
          eta: 0.4802025848144224
          gamma: 0.01363825229793838
          grow_policy: lossguide
    outs:
    - path: out/models/data_pipeline_xgboost.pkl
      hash: md5
      md5: fd9986981188f504b8a7d9f9dc67e68c
      size: 1204
    - path: out/models/model_xgboost.pkl
      hash: md5
      md5: f5ed57c419ce8b7331f89ce3f08d82a2
      size: 33002
  train_imputer:
    cmd: poetry run python insurance/torch_imputer.py  data/prepared/prepared_data.feather
    deps:
    - path: data/prepared/prepared_data.feather
      hash: md5
      md5: be9be223edd7835c118acb707733196d
      size: 57045410
    - path: insurance/torch_imputer.py
      hash: md5
      md5: 13724a55f61bb5ef00ccd881e5e6cf70
      size: 7037
    params:
      params.yaml:
        torch_imputer:
          epochs: 100
          lr: 0.001
          batch_size: 2048
    outs:
    - path: out/models/torch_imputer.pt
      hash: md5
      md5: 4b9d1eac1f73a8d0dfa96af091219876
      size: 13316
